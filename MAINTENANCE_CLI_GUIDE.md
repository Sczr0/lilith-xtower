# 维护配置 CLI 快速指南

## 🚀 快速开始

### 启动管理工具

```bash
npm run content
```

选择菜单中的 **"⚙️ 维护配置管理"**

## 📋 功能菜单

```
⚙️ 维护配置管理
├── 👁️  查看当前配置
├── ✏️  编辑配置
├── 🔄 快速测试（立即进入维护）
└── ↩️  返回主菜单
```

## 1️⃣ 查看当前配置

显示所有维护配置参数和当前状态：

```
⚙️  当前维护配置:

✅ 启用状态: 🔴 已禁用
📅 维护开始: 2025-01-20T09:00:00
📅 维护结束: 2025-01-20T12:00:00
📢 提前通知: 3 天
📝 标题: 系统维护通知
📝 维护消息:
   受 Phigros 更新影响，本服务正在进行例行维护...
📝 横幅消息:
   本服务将于 2025年1月20日 09:00（UTC+8）开始例行维护...

⚪ 当前状态: 维护模式未启用
```

## 2️⃣ 编辑配置

交互式编辑所有配置项：

### 步骤说明

1. **启用维护模式检查?** (Y/n)
   - Y: 启用维护检查
   - n: 禁用维护检查

2. **维护开始时间**
   - 格式：`YYYY-MM-DDTHH:mm:ss`
   - 示例：`2025-01-20T09:00:00`

3. **维护结束时间**
   - 格式：`YYYY-MM-DDTHH:mm:ss`
   - 示例：`2025-01-20T12:00:00`

4. **提前多少天显示预告横幅?**
   - 输入数字：0-30
   - 建议：3-7天

5. **维护标题**
   - 示例：`系统维护通知`

6. **维护消息 (支持HTML)**
   - 可以包含 `<br/>`, `<strong>` 等标签
   - 示例：
     ```
     受 Phigros 更新影响，本服务正在进行例行维护。<br/>
     <strong>预计恢复时间：2025年1月20日 12:00（UTC+8）</strong>
     ```

7. **横幅消息 (支持HTML)**
   - 示例：
     ```
     <strong>维护通知：</strong> 本服务将于 <strong>2025年1月20日 09:00</strong> 开始例行维护
     ```

8. **确认保存配置?** (Y/n)
   - Y: 保存配置到 `maintenance.config.ts`
   - n: 取消操作

## 3️⃣ 快速测试

用于测试维护功能是否正常工作：

### 测试选项

#### 🔴 测试维护覆盖层（立即进入维护）
- 立即启用维护模式
- 持续 10 分钟
- 页面显示全屏维护覆盖
- 用于测试维护界面样式和内容

#### 🟡 测试预告横幅（5分钟后维护）
- 立即显示维护预告横幅
- 5分钟后进入维护模式
- 用于测试横幅显示效果

### 测试步骤

1. 选择测试类型
2. 等待配置写入完成
3. 刷新浏览器查看效果
4. 测试完成后：
   - 返回编辑配置
   - 将 `enabled` 改为 `false`
   - 或者等待测试自动结束

## 📝 使用示例

### 示例 1: 设置正式维护

假设需要在 2025年1月20日 09:00-12:00 进行维护，提前3天通知：

1. 运行 `npm run content`
2. 选择 "⚙️ 维护配置管理" → "✏️ 编辑配置"
3. 填写配置：
   ```
   启用维护模式检查? Y
   维护开始时间: 2025-01-20T09:00:00
   维护结束时间: 2025-01-20T12:00:00
   提前多少天显示预告横幅? 3
   维护标题: 系统维护通知
   维护消息: 受 Phigros 更新影响，本服务正在进行例行维护。<br/><strong>预计恢复时间：2025年1月20日 12:00（UTC+8）</strong>
   横幅消息: <strong>维护通知：</strong> 本服务将于 <strong>2025年1月20日 09:00（UTC+8）</strong> 开始例行维护，预计 <strong>12:00</strong> 恢复。
   确认保存配置? Y
   ```
4. 完成！

### 示例 2: 快速测试维护界面

需要测试维护界面是否正确显示：

1. 运行 `npm run content`
2. 选择 "⚙️ 维护配置管理" → "🔄 快速测试"
3. 选择 "测试维护覆盖层（立即进入维护）"
4. 刷新浏览器查看全屏维护界面
5. 测试完成后禁用维护模式

### 示例 3: 紧急维护（立即生效）

需要立即进入维护模式：

1. 运行 `npm run content`
2. 选择 "⚙️ 维护配置管理" → "✏️ 编辑配置"
3. 设置：
   ```
   启用维护模式检查? Y
   维护开始时间: [当前时间]
   维护结束时间: [维护结束时间]
   提前多少天显示预告横幅? 0
   ```
4. 保存后立即生效

## ⚠️ 注意事项

1. **时间格式严格**：必须是 `YYYY-MM-DDTHH:mm:ss` 格式
2. **时区说明**：时间为本地时间，无需转换时区
3. **测试后记得禁用**：快速测试后要禁用维护模式
4. **配置立即生效**：保存后刷新页面即可看到效果
5. **维护期间全站不可用**：所有页面和功能都无法访问

## 🔄 维护状态说明

CLI 工具会自动判断当前状态：

- 🟢 **维护已结束**：已过维护结束时间
- 🔴 **维护中**：正在维护期间
- 🟡 **预告期（显示横幅）**：维护前N天
- ⏳ **等待预告期**：还未到预告时间
- ⚪ **维护模式未启用**：enabled = false

## 💡 最佳实践

1. **提前规划**：至少提前3-7天设置维护通知
2. **明确时间**：在消息中明确说明维护开始和结束时间
3. **先测试**：正式维护前使用快速测试验证配置
4. **及时更新**：维护结束后及时禁用维护模式
5. **备份配置**：重要维护前备份 `maintenance.config.ts`

## 📂 配置文件位置

```
src/app/config/maintenance.config.ts
```

可以直接编辑此文件，也可以通过 CLI 工具管理。

## 🆘 常见问题

### Q: 修改配置后没有生效？
A: 刷新浏览器页面，配置会立即生效。

### Q: 如何取消已设置的维护？
A: 编辑配置，将 `enabled` 改为 `false`。

### Q: 维护时间过了还显示维护中？
A: 检查 `endTime` 是否正确，系统每分钟检查一次。

### Q: 如何修改维护消息的样式？
A: 消息支持 HTML，可以使用 `<br/>`, `<strong>`, `<a>` 等标签。

## 📚 相关文档

- [维护模式完整指南](./MAINTENANCE_GUIDE.md)
- [内容管理系统文档](./CONTENT_MANAGEMENT.md)
- [CLI 工具提示](./CONTENT_CLI_TIPS.md)
